---
layout: post
title: 'WebP: One image format to rule them all'
categories: []
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  dsq_thread_id: '1350748224'
author:
  login: cradmin
  email: c.rumpel@kabsi.at
  display_name: cradmin
  first_name: ''
  last_name: ''
---
<p class="article__intro">In my <a title="Front-end performance images" href="http://christoph-rumpel.com/2013/05/front-end-performance-part-02-images/" target="_blank">last article</a> i wrote about the importance of images regarding performance. <a title="Hugo Giraudel Blog" href="http://hugogiraudel.com/" target="_blank">Hugo Giraudel</a> pointed out, that i forgot to write about the WebP image format and he was right. So i needed to get myself familiar with this format in order to update my article. It turned it was impossible to summarise this amazing topic in a few sentences. This is why i decided to give WebP the attention it deserves and why i wrote this new little article about it.</p>
<p><strong>WebP is a new image format by Google</strong> which can be used for all kinds of images for the web. It supports lossy and lossless image compression, as well as transparency. This means you do not have to think about if JPG, PNG or GIF would be the best decision for your needs. Additionally <strong>WebP images are 20-30% smaller in file size</strong> which is a lot. It achieves better compression by spending more CPU cycles. Compared to JPG, encoding and decoding of a WebP image is much slower, but due to the smaller file size it is still loaded faster.</p>
<p>I already wrote about the importance of images regarding front-end performance and how we can optimise them, but this even better. In a test for my own portfolio site I was able to reduce the data size by 37% from the already optimised files. This is incredible!</p>
<p>So why is not everybody already using WebP?</p>
<h3 class="article__subheadline">Support</h3>
<p><strong>A big downside here is the support</strong>. WebP is supported by Chrome, Opera and Android 4+. This means it cannot be used in all versions of IE and Firefox yet. But Mozilla is already reconsidering their former decision not to support WebP. File size reduction is just too important. They can't ignore that chance to make their browser and the web faster.</p>
<blockquote><p>We decided to re-open this based on new data that shows that WebP has valid use cases and advantages. We will evaluate a refreshed patch and take it from there.</p></blockquote>
<p class="quote-author">Andreas Gal, Mozilla</p>
<h3 class="article__subheadline">Examples</h3>
<p>So let us take a look at some examples. <strong>Ebay</strong> has already tested WebP on a site with 50 images. On <a title="WebPagetest Ebay" href="http://www.webpagetest.org/video/compare.php?tests=130125_6N_KZA%2C130125_NH_KZ8&amp;thumbSize=200&amp;ival=100&amp;end=full" target="_blank">WebPagetest</a>  you can see that WebP images are loaded much faster compared to JPGs.</p>
<p><strong>Facebook</strong> has already tested this new image format too. Uploaded JPGs were converted to WebP files and delivered to browser which support that format. Problems occurred when users saved those images to their computer and tried to open them. WebP is not natively supported by Windows or OS X.</p>
<blockquote><p>Personally, I am thrilled about WebP and progressive JPEGs, and I hope more browser providers will come on board to support WebP in the future.</p></blockquote>
<p class="quote-author">Raja Bhogi, Ebay</p>
<p>For a platform like Facebook, Flickr or Pinterest WebP could lower its networks costs tremendously. This is why Facebook is also interested in getting more browsers to support this format.</p>
<h3 class="article__subheadline">Tools</h3>
<p>Since WebP is still a new and young format <strong>nearly no applications support it natively</strong>. I guess this will change soon, but in the meantime we will have to extend our apps by our own.</p>
<p>There is a <a title="WebP Command-line converter tool" href="https://developers.google.com/speed/webp/download" target="_blank">command-line converter tool</a>  by Google available for Windows, Linux and Mac OSX. Additonally there is also a handy online converter tool called <a title="WebP online converter" href="http://img2webp.net/" target="_blank">IMG2WebP</a>  which is perfect for a quick look at WebP images and a <a title="WebP Adobe Photoshop plugin" href="http://telegraphics.com.au/sw/product/WebPFormat" target="_blank">Adobe Photoshop Plugin</a>. Take some time and convert a bunch of your images, play with the settings and watch yourself getting excited about this image format too.</p>
<h3 class="article__subheadline">Client-side implementation</h3>
<p>So what are our possibilities to work with this format today?</p>
<p>To be honest, there are just a view. On the client side we can <strong>detect if a browser supports WebP through JavaScript</strong>. There is a non-core detection available through <a title="Modernizr WebP detection" href="http://modernizr.com/download/#-img_webp" target="_blank">Modernizr</a>.</p>
<pre><code>if ( !Modernizr.webp ) {
    image.src="image.jpg";
}</code></pre>
<p>If WebP is not supported, I just change the image src attribute. A big disadvantage here is, that the WebP version is loaded too, even if the browser doesn't support it.</p>
<p>Upcoming <a title="W3C image fallbacks" href="http://www.w3.org/TR/css4-images/#image-fallbacks" target="_blank">CSS image fallbacks</a> will do the trick for background-images. As you can see you will be able to list fallback images if a certain format is not supported or a file cannot be found.</p>
<pre><code>background-image: image("whatever.webp" format('webp'), "whatever.jpg");</code></pre>
<p>We need to provide the image format next to the WebP URL in order to prevent browsers to try to decode files they don't know. This would be the case when they don't support WebP images. This technique is by <a title="Jake Archibald WebP CSS background images" href="http://lists.w3.org/Archives/Public/www-style/2013Feb/0352.html" target="_blank">Jake Archibald</a>.</p>
<h3 class="article__subheadline">Server-side implementation</h3>
<p>We saw that the client-side implementation isn't very satisfying. What can do on the server?</p>
<p>An interesting technique here is to <strong>write a rule for file formats</strong>. First we are going to check browser support for WebP. If this is true, then we are going to deliver different files from the ones requested to the browser. Let's take a look at the code.</p>
<pre><code>&lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On
    RewriteCond %{HTTP_USER_AGENT} !(Chrome\/[0-8]|Android\s[0-3])\.
    RewriteCond %{HTTP_USER_AGENT} Chrome [OR]
    RewriteCond %{HTTP_ACCEPT} image/webp
    RewriteCond /www/htdocs/rootofyoursever/christoph/tests/webp/$1.webp -f
    RewriteRule ^(images.+)\.(jpe?g|png)$ $1.webp [T=image/webp,E=accept:1]
&lt;/IfModule&gt;

&lt;IfModule mod_headers.c&gt;
    Header append Vary Accept env=REDIRECT_accept
&lt;/IfModule&gt;

AddType image/webp .webp</code></pre>
<p>The cool thing here is, <strong>we do not have to change the markup.</strong> We are asking the server for a JPG or PNG file, but we are getting back a WebP one if supported. Checkout my simple <a title="WebP demo" href="http://tests.christoph-rumpel.com/webp/serverside/" target="_blank">demo</a> where i tested this and the client-side method.</p>
<h3 class="article__subheadline">Conclusion</h3>
<p>WebP is definitely a great new image format that could change the way we handle images for the web. It combines all benefits from the formats we use today while providing a smaller file size. Awesome!</p>
<p>Unfortunately support for WebP is very low yet and therefor i would't recommend implementing this new file format right now. Of course when you are dealing with lots of images the user doesn't need to download and browser support satisfies your needs, then WebP could improve your projects even today.</p>
<p>Either way you should make yourself familiar with it, since it could become the web image format number one.</p>
<p>&nbsp;</p>
<h4>Resources</h4>
<p>Tools</p>
<ul>
<li><a title="IMG2WebP online converter" href="http://img2webp.net/" target="_blank">IMG2WebP Online Converter</a></li>
<li><a title="Google WebP downloads" href="https://developers.google.com/speed/webp/download" target="_blank">Google: Downloading and installing WebP</a></li>
<li><a title="Adobe Photoshop plugin" href="http://telegraphics.com.au/sw/product/WebPFormat" target="_blank">Adobe Photoshop plugin</a></li>
</ul>
<p>Further reading</p>
<ul>
<li><a title="CNET News WebP" href="http://news.cnet.com/8301-1023_3-57578813-93/why-mozilla-had-a-change-of-heart-about-webp-images/" target="_blank">CNET News: Why Mozilla had a change of heart about WebP images</a></li>
<li><a title="Using WebP images today" href="http://www.enov8.co.uk/web-design-blog/2013/05/29/using-webp-images-today/" target="_blank">Enovate Design: Using WebP images today</a></li>
<li><a title="Webmonkey WebP diet" href="http://www.webmonkey.com/2013/03/put-your-site-on-a-diet-with-googles-image-shrinking-webp-format/" target="_blank">Webmonkey: Put Your Site on a Diet With Google’s Image-Shrinking ‘WebP’ Format</a></li>
<li><a title="Cup Magazin WebP" href="http://cup.wpcoder.de/webp-jpeg-alternative/" target="_blank">WordPress Cup Magazin: JPEG-Nachfolger: Einführung in das sparsame Bildformat WebP </a></li>
<li><a title="Ilya Grigorik WebP" href="http://www.igvita.com/2013/03/07/faster-smaller-and-more-beautiful-web-with-webp/" target="_blank">Ilya Grigorik: Faster, smaller and more beautiful web with WebP</a></li>
</ul>
